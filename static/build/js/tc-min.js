var tc=tc||{};tc.gam=tc.gam||{};var app_page=app_page||{};if(typeof jQuery!="undefined"){tc.jQ=jQuery}tc.util=tc.util||{};tc.util.log=function(a,b){if(app_page&&app_page.prevent_logging){return}if(typeof console!="undefined"&&typeof console.log!="undefined"){if(!b){console.info(a)}else{console[b](a)}}if(typeof ipd!="undefined"&&typeof ipd.log!="undefined"){ipd.log(a)}};tc.util.dump=function(a){if(app_page&&app_page.prevent_logging){return}if(typeof console!="undefined"&&typeof console.log!="undefined"){console.log(a)}if(typeof ipd!="undefined"&&typeof ipd.log!="undefined"){ipd.log(a)}};tc.timer=function(d,c,e){var b={timer:setTimeout(c,d),callback:null};if(typeof(e)=="function"){b.callback=e}return b};tc.clearTimer=function(b){clearTimeout(b.timer);if(typeof(b.callback)=="function"){b.callback()}return this};tc.animate_bg=function(b,d,c){d+=(d>c)?-0.25:0.25;if(!tc.jQ.support.opacity){if(d!=c){var a=(Math.round(d*25.5)).toString(16);b.css({backgroundColor:"transparent",filter:"progid:DXImageTransform.Microsoft.gradient(startColorstr=#"+a+"FFFFFF, endColorstr=#"+a+"FFFFFF) !important","-ms-filter":"progid:DXImageTransform.Microsoft.gradient(startColorstr=#"+a+"FFFFFF, endColorstr=#"+a+"FFFFFF) !important"})}else{}}else{b.css("backgroundColor","rgba(255, 255, 255, "+(d)/10+")")}if(d!=c){setTimeout(function(){tc.animate_bg(b,d,c)},50)}};tc.addOfficialResourceTags=function(d){var a=d.find("td.official-resource");d.parent().children(".official-resource-tag").remove();for(var b=0;b<a.length;b++){var f=a.eq(b);var c=f.position();var e=f.outerWidth();d.before('<div class="official-resource-tag" id="tag-'+b+'" style="top:'+c.top+"px; left:"+c.left+"px; width:"+(e-48)+'px"><span>Official Resource</span></div>');f.css({"padding-top":"25px"})}};tc.truncate=function(c,a,b){if(typeof c==="string"){if(c.length>a){return c.substring(0,a)+(b||"&hellip;")}}return c};tc.randomNoteCardBg=function(b){var a=b.children("li");for(i=0;i<a.length;i++){a.eq(i).children(".note-card").addClass("card"+(Math.floor(Math.random()*4)+1))}};tc.makeEmailLink=function(a,b){addr=a+"@"+b;s='<a href="mailto:'+addr+'">'+addr+"</a>";return s};tc.jQ.fn.time_since=function(){return this.each(function(){var b,a;b=tc.jQ(this);a=b.text();b.attr("title",a.split(" ").join("T")+"Z");b.prettyDate()})};function makeClass(){return function(a){if(this instanceof arguments.callee){if(typeof this.init=="function"){this.init.apply(this,a.callee?a:arguments)}}else{return new arguments.callee(arguments)}}}var ua=tc.jQ.browser;var os="";var isMsie8orBelow=false;var isMsie7orBelow=false;var isiPad=false;tc.browserDetection=function(){if(ua&&ua.msie&&ua.version<9){isMsie8orBelow=true;(function(){var a=document.title.split("#")[0];document.attachEvent("onpropertychange",function(b){if(b.propertyName==="title"&&document.title!==a){document.title=a}})}());if(ua.version<8){tc.jQ("body").addClass("ie7");isMsie7orBelow=true}}if(ua.mozilla){if(ua.version.slice(0,5)=="1.9.0"){tc.jQ("body").addClass("ff3")}else{if(ua.version.slice(0,5)=="1.9.1"){}}}else{if(ua.webkit){tc.jQ("body").addClass("webkit")}}if(navigator.userAgent.indexOf("Chrome")!=-1){tc.jQ("body").addClass("chrome")}if(navigator.appVersion.indexOf("Win")!=-1){os="windows"}else{if(navigator.appVersion.indexOf("Mac")!=-1){os="mac"}}if(navigator.userAgent.match(/iPad/i)!=null){os="ipad";isiPad=true}tc.jQ("body").addClass(os)};tc.browserDetection();tc.validator_regex={email:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,url:/^((ht|f)tps?:\/\/)?[a-z0-9-\.]+\.[a-z]{2,4}\/?([^\s<>\%"\,\{\}\\|\\\^\[\]`]+)?$/};tc.password={m_strUpperCase:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",m_strLowerCase:"abcdefghijklmnopqrstuvwxyz",m_strNumber:"0123456789",m_strCharacters:"!@#$%^&*?_~"};tc.validator_utils={};tc.validator_utils.is_empty=function(a){return tc.jQ.trim(a)?false:true};tc.validator_utils.val_escape_hints=function(a){var b=a.val();var c=a.data().input?a.data().input.hint:null;if(!c){return b}return(b===c?"":b)};tc.validate=function(f,c){var a=true;var k=false;var m=[];var g,n,l,e,b,h,d;if(!f instanceof tc.jQ){f=tc.jQ(f)}n=f.val();if(!f.get(0)){return{valid:false,errors:["Input not found."],data:f}}for(e in c){if(c[e].substring(0,3)=="min"){n=tc.validator_utils.val_escape_hints(f);l=parseFloat(n);if(isNaN(l)){if(n.length<(c[e].split("-")[1]*1)){a=false;m.push("Too short.")}}else{if(n<(c[e].split("-")[1]*1)){a=false;m.push("Too small.")}}continue}if(c[e].substring(0,3)=="max"){n=tc.validator_utils.val_escape_hints(f);l=parseFloat(n);if(isNaN(l)){if(n.length>(c[e].split("-")[1]*1)){a=false;m.push("Too long.")}}else{if(n>(c[e].split("-")[1]*1)){a=false;m.push("Too big.")}}continue}if(c[e].substring(0,3)=="not"){if(n===c[e].split("-")[1]){a=false;m.push("Invalid value.")}continue}if(c[e].substring(0,8)=="password"){b=tc.password_strength(n);h=f.filter(".has-been-focused").siblings(".pass-strength");if(b<(c[e].split("-")[1]*1)){a=false;m.push("Too Weak.");if(h.length){h.text("Too weak").addClass("weak")}}else{if(h.length){h.text("Strong").removeClass("weak")}}continue}switch(c[e]){case"required":k=true;if(f.get(0).type=="checkbox"){if(!f.filter(":checked").length||!f.get(0).checked){a=false;m.push("This is required.")}}else{n=tc.validator_utils.val_escape_hints(f);if(!n.length){g=true;a=false;m.push("This is required.")}}break;case"csv-email":n=n.split(",");for(d in n){if(!tc.validator_regex.email.test(tc.jQ.trim(n[d]))){a=false;m.push("Invalid Email.")}}break;case"email":h=f.filter(".has-attempted-submit").parent().parent().find(".email-error");if(!tc.validator_regex.email.test(n)){a=false;if(h.length){h.show()}m.push("Invalid Email.")}else{if(h.length){h.hide()}}break;case"csv-url":n=n.split(",");for(d in n){if(!tc.validator_regex.url.test(tc.jQ.trim(n[d]))){a=false;m.push("Invalid Url.")}}break;case"url":if(!tc.validator_regex.url.test(n)){a=false;m.push("Invalid Url.")}break;case"numeric":if(isNaN(Number(n))){a=false;m.push("Not a number.")}break;case"selected":if(n=="-1"){a=false;m.push("Must select a value.")}break}}if(!a&&!k&&!tc.jQ.trim(n).length){a=true}if(a){f.removeClass("not-valid");if(k||tc.jQ.trim(n).length){f.addClass("valid")}return{valid:true}}else{f.removeClass("valid").addClass("not-valid");return{valid:false,errors:m}}};tc.password_strength=function(e){var d=0;if(e.length<5){d+=5}else{if(e.length>4&&e.length<8){d+=10}else{if(e.length>7){d+=25}}}var f=tc.countContain(e,tc.password.m_strUpperCase);var g=tc.countContain(e,tc.password.m_strLowerCase);var a=f+g;if(f==0&&g!=0){d+=10}else{if(f!=0&&g!=0){d+=20}}var b=tc.countContain(e,tc.password.m_strNumber);if(b==1){d+=10}if(b>=3){d+=20}var c=tc.countContain(e,tc.password.m_strCharacters);if(c==1){d+=10}if(c>1){d+=25}if(b!=0&&a!=0){d+=2}if(b!=0&&a!=0&&c!=0){d+=3}if(b!=0&&f!=0&&g!=0&&c!=0){d+=5}return d};tc.countContain=function(c,b){var a=0;for(i=0;i<c.length;i++){if(b.indexOf(c.charAt(i))>-1){a++}}return a};tc.merlin=tc.merlin||makeClass();tc.merlin.prototype.options={name:null,dom:null,progress_element:null,next_button:null,back_button:null,watch_keypress:true,first_step:"start",allow_hash_override_onload:false,use_hashchange:true,steps:{start:{progress_selector:".1",selector:".start",prev_step:null,next_step:null}}};tc.merlin.prototype.init=function(b,a){this.options=tc.jQ.extend({},this.options,a);this.app=b;if(this.options.dom instanceof String){this.options.dom=tc.jQ(a.dom)}this.dom=this.options.dom;this.magic=null;this.event_data={app:b,me:this};this.handle_steps();this.handle_controls(a.controls);this.setup_events(b);if(this.options.use_hashchange&&this.options.allow_hash_override_onload){this.set_address(window.location.hash.substring(1,window.location.hash.length))}else{if(this.options.first_step){this.show_step(this.options.first_step)}}this.current_hash=null};tc.merlin.prototype.setup_events=function(a){if(this.options.use_hashchange){tc.jQ(window).unbind("hashchange",this.event_data,this.handlers.hashchange).bind("hashchange",this.event_data,this.handlers.hashchange)}if(this.dom){this.dom.find("a.step_link").unbind("click").bind("click",this.event_data,this.handlers.a_click);this.dom.bind("merlin-step-valid",this.event_data,this.handlers.valid);this.dom.bind("merlin-step-invalid",this.event_data,this.handlers.invalid)}if(this.options.back_button){this.options.back_button.unbind("click").bind("click",this.event_data,this.handlers.prev_step)}if(this.options.next_button){this.options.next_button.addClass("disabled");this.options.next_button.unbind("click").bind("click",this.event_data,this.handlers.next_step)}};tc.merlin.prototype.deallocate_magic=function(){if(this.options.use_hashchange){tc.jQ(window).unbind("hashchange",this.handlers.hashchange)}if(this.dom){this.dom.find("a.step_link").unbind("click",this.handlers.a_click);this.dom.unbind("merlin-step-valid",this.handlers.valid);this.dom.unbind("merlin-step-invalid",this.handlers.invalid)}if(this.options.back_button){this.options.back_button.unbind("click",this.handlers.prev_step)}if(this.options.next_button){this.options.next_button.unbind("click",this.handlers.next_step)}};tc.merlin.prototype.handle_controls=function(a){if(this.options.progress_element){this.options.progress_element.find("a.indicator").bind("click",this.event_data,this.handlers.indicator_click)}if(this.options.error_indicator){this.options.error_indicator.html("<span></span>")}};tc.merlin.prototype.handle_steps=function(){if(this.options.magic){this.magic=this.magic_spell()}var a;for(a in this.options.steps){if(this.options.steps[a].selector&&this.dom){this.options.steps[a].dom=this.dom.find(this.options.steps[a].selector)}}};tc.merlin.prototype.magic_spell=function(){var a;var b;b=({n_items:0,overall_width:0,page_width:0,item_metadata:{max_width:0,min_width:100000,max_height:0,min_height:100000,marginLeft:0},$items:[],init:function(c){this.merlin=c;for(a in this.merlin.options.steps){this.merlin.options.steps[a].magic_dom=this.merlin.dom.children().filter(this.merlin.options.steps[a].selector);if(this.merlin.options.steps[a].magic_dom.length){this.$items.push(this.merlin.options.steps[a].magic_dom.get(0));if(this.merlin.options.steps[a].magic_dom.outerWidth()<this.item_metadata.min_width){this.item_metadata.min_width=this.merlin.options.steps[a].magic_dom.outerWidth()}if(this.merlin.options.steps[a].magic_dom.outerWidth()>this.item_metadata.max_width){this.item_metadata.max_width=this.merlin.options.steps[a].magic_dom.outerWidth()}if(this.merlin.options.steps[a].magic_dom.outerHeight()<this.item_metadata.min_height){this.item_metadata.min_height=this.merlin.options.steps[a].magic_dom.outerHeight()}if(this.merlin.options.steps[a].magic_dom.outerHeight()>this.item_metadata.max_height){this.item_metadata.max_height=this.merlin.options.steps[a].magic_dom.outerHeight()}}}this.n_items=this.$items.length;this.$items=tc.jQ(this.$items);this.page_width=tc.jQ(window).width();this.overall_width=(this.page_width*this.n_items);this.item_metadata.marginLeft=(this.page_width-this.item_metadata.max_width)/2;this.merlin.dom.css({width:this.overall_width+"px",height:this.item_metadata.max_height+"px"});this.$items.show().css({"float":"left",clear:"none",width:this.item_metadata.max_width+"px",marginLeft:this.item_metadata.marginLeft}).removeClass("clearfix");return this},resize_handler:function(c){},show_step:function(c){if(!c.magic_dom){return}this.merlin.dom.css({marginLeft:((c.magic_dom.position().left))+"px"})}}).init(this);return b};tc.merlin.prototype.show_step=function(c,d){var b;var a;var e;if(this.current_step&&!d){if(c==this.current_step.step_name){if(!this.current_step.dom.filter(":visible").length){this.current_step.dom.show()}return}if(this.current_step){if(tc.jQ.isFunction(this.current_step.finish)){this.current_step.finish(this,this.current_step.dom)}}}if(d&&this.current_step){if(tc.jQ.isFunction(this.current_step.finish)){this.current_step.finish(this,this.current_step.dom)}}if(!this.options.steps[c]){return}this.options.steps[c].step_name=c;if(this.current_step&&this.current_step.use_for_history){this.options.steps[c].prev_step=this.current_step.step_name}else{if(this.current_step){this.options.steps[c].prev_step=this.current_step.prev_step}}this.current_step=this.options.steps[c];if(this.options.next_button){this.options.next_button.removeClass("disabled")}if(this.current_step.progress_selector){if(this.options.progress_element){this.options.progress_element.find(this.current_step.progress_selector).addClass("cur").attr("href","#"+this.current_step.step_name).nextAll().removeClass("cur").attr("href","#")}}if(this.current_step.title&&this.options.title){this.options.title.html(this.current_step.title)}if(this.current_step.sub_title&&this.options.sub_title){this.options.sub_title.html(this.current_step.sub_title)}if(tc.jQ.isFunction(this.current_step)){this.current_step(this);return}if(tc.jQ.isFunction(this.current_step.transition)){this.current_step.transition(this)}else{if(this.magic){this.magic.show_step(this.current_step)}else{if(this.dom&&!this.magic){this.dom.find(".step").hide();this.dom.find(this.current_step.selector).show()}}}if(this.current_step.inputs&&!this.current_step.has_been_initialized){for(b in this.current_step.inputs){if(!this.current_step.inputs[b].dom&&this.current_step.inputs[b].selector){this.current_step.inputs[b].dom=this.current_step.dom.find(this.current_step.inputs[b].selector);if(!this.current_step.inputs[b].dom.length){tc.util.dump(this.current_step.inputs[b].selector)}}if(this.current_step.inputs[b].dom.val()){this.current_step.inputs[b].default_val=this.current_step.inputs[b].dom.val()}e=tc.jQ.extend({},this.event_data,{input:this.current_step.inputs[b]});if(this.current_step.inputs[b].counter&&!this.current_step.inputs[b].counter.dom){this.current_step.inputs[b].counter.dom=this.current_step.dom.find(this.current_step.inputs[b].counter.selector);this.current_step.inputs[b].counter.dom.text("0/"+this.current_step.inputs[b].counter.limit)}this.current_step.inputs[b].dom.bind("focus",e,this.handlers.focus).bind("keyup change",e,this.handlers.keypress).bind("blur",e,this.handlers.blur).data({merlin:this,input:this.current_step.inputs[b]}).each(function(g,f){var h=tc.jQ(f);if(h.data().input.hint||(h.data().input.hint==="")){f.value=h.data().input.hint}});if(this.current_step.inputs[b].handlers){for(a in this.current_step.inputs[b].handlers){this.current_step.inputs[b].dom.bind(a,this.event_data,this.current_step.inputs[b].handlers[a])}}if(this.current_step.inputs[b].focus_first){}}}if(this.options.use_hashchange&&!this.current_step.supress_hash){if(this.options.name){window.location.hash=this.options.name+","+c}else{window.location.hash=c}}if(tc.jQ.isFunction(this.current_step.init)){this.current_step.init(this,this.current_step.dom)}this.validate(false);this.current_step.has_been_initialized=true};tc.merlin.prototype.set_address=function(c){var b;var a=c.split(",");if(this.options.name){if(a[0]!==this.options.name){this.current_hash=null;return}c=a[1];b=true}else{if(this.current_hash!==c){b=false}}this.current_hash=c;this.show_step(this.current_hash,b)};tc.merlin.prototype.validate=function(b){var a;var d=true;var c;this.current_step.errors=[];if(!this.current_step.inputs){return true}for(a in this.current_step.inputs){if(!this.current_step.inputs[a].validators){continue}if(b){this.current_step.inputs[a].dom.addClass("has-been-focused has-attempted-submit");if(this.current_step.inputs[a].hint&&(this.current_step.inputs[a].dom.val()==this.current_step.inputs[a].hint)){this.current_step.inputs[a].dom.val("")}}if(tc.jQ.isFunction(this.current_step.inputs[a].validators)){c=this.current_step.inputs[a].validators(this,this.current_step.inputs[a].dom,this.current_step,b)}else{c=tc.validate(this.current_step.inputs[a].dom,this.current_step.inputs[a].validators)}if(!c.valid){d=false;if(this.current_step.inputs[a].counter&&this.current_step.inputs[a].dom.hasClass("has-been-focused")){this.current_step.inputs[a].counter.dom.addClass("invalid").removeClass("valid")}}else{if(this.current_step.inputs[a].counter&&this.current_step.inputs[a].counter.dom.hasClass("invalid")){this.current_step.inputs[a].counter.dom.addClass("valid").removeClass("invalid")}}}if(d){if(this.dom){this.dom.trigger("merlin-step-valid",{step:this.current_step})}this.current_step.dom.removeClass("invalid").addClass("valid");return true}else{if(this.dom){this.dom.trigger("merlin-step-invalid",{step:this.current_step})}this.current_step.dom.removeClass("valid").addClass("invalid");return false}};tc.merlin.prototype.handlers={};tc.merlin.prototype.handlers.hashchange=function(a,b){a.data.me.set_address(window.location.hash.substring(1,window.location.hash.length))};tc.merlin.prototype.handlers.indicator_click=function(a,b){if(tc.jQ(a.target).parent().attr("href")=="#"){a.preventDefault()}};tc.merlin.prototype.handlers.a_click=function(a,b){};tc.merlin.prototype.handlers.prev_step=function(a,b){a.preventDefault();if(a.data.me.current_step&&a.data.me.current_step.prev_step){if(a.data.me.options.use_hashchange){window.location.hash=a.data.me.current_step.prev_step}else{a.data.me.show_step(a.data.me.current_step.prev_step)}}};tc.merlin.prototype.handlers.next_step=function(b,c){var a;b.preventDefault();a=b.data.me.validate(true);if(!a){if(b.data.me.options.error_indicator){b.data.me.options.error_indicator.html("<span>Oops! Please fill in the fields marked in red.</span>").show()}return}else{if(b.data.me.options.error_indicator){b.data.me.options.error_indicator.hide()}}if(b.target.className.indexOf("disabled")>0){return}if(b.data.me.current_step&&b.data.me.current_step.next_step){b.data.me.show_step(b.data.me.current_step.next_step)}};tc.merlin.prototype.handlers.focus=function(a,b){var c;if(a.target.className.indexOf("has-been-focused")==-1){c=tc.jQ(a.target);c.addClass("has-been-focused").removeClass("valid invalid");if(a.target.nodeName=="TEXTAREA"||(a.target.nodeName=="INPUT"&&(c.attr("type")=="text"))){if(c.data().input.hint||c.data().input.hint===""){c.val("")}}}};tc.merlin.prototype.handlers.keypress=function(a,b){a.data.me.validate(false);if(a.which==13&&a.target.nodeName!="TEXTAREA"){if(a.data.me.options.next_button&&a.data.me.options.next_button.hasClass("enabled")){a.data.me.options.next_button.click()}}if(a.data.input.counter&&a.data.input.counter.dom){a.data.input.counter.dom.text(a.data.input.dom.val().length+"/"+a.data.input.counter.limit)}};tc.merlin.prototype.handlers.blur=function(a,b){var c;c=tc.jQ(a.target);if(!a.target.value.length){tc.jQ(a.target).removeClass("has-been-focused");if(c.data().input.hint||(c.data().input.hint==="")){c.val(c.data().input.hint)}}};tc.merlin.prototype.handlers.valid=function(a,b){if(a.data.me.options.next_button){a.data.me.options.next_button.removeClass("disabled").addClass("enabled")}if(a.data.me.options.error_indicator){a.data.me.options.error_indicator.hide()}};tc.merlin.prototype.handlers.invalid=function(a,b){if(a.data.me.options.next_button){a.data.me.options.next_button.removeClass("enabled").addClass("disabled")}};var tc=tc||{};tc.top_bar=function(c,b){var f=tc.jQ.extend({slideSpeed:250,fadeSpeed:200},b),a={};tc.jQ("div.dropdown").removeClass("no-js");var d=function(g){tc.jQ.ajax({url:"/rest/v1/keywords/",dataType:"json",success:function(j,h,k){if(g){g(j,h,k)}}})};a._getTagsMarkup=function(g){return tc.jQ.map(g,function(h,j){return'<a href="/search?terms='+h.name+'">'+h.name+"</a> ("+h.count+")"}).join(", ")};function e(){if(isiPad===true){c.find(".username > a, .myprojects > a, .lang > a").removeAttr("href");c.find(".username > a, .myprojects > a, .lang > a").toggle(function(){tc.jQ(".userland .dropdown").hide();tc.jQ(this).parent().children(".dropdown").stop(true,true).slideDown(f.slideSpeed)},function(){tc.jQ(this).parent().children(".dropdown").fadeOut(f.fadeSpeed)})}else{c.find(".username, .myprojects, .lang-selector, .search-button").mouseenter(function(){if($.browser.msie&&$.browser.version<8){tc.jQ(this).children(".dropdown").stop(true,true).fadeIn(f.slideSpeed)}else{tc.jQ(this).children(".dropdown").stop(true,true).slideDown(f.slideSpeed)}tc.jQ(this).children("a").toggleClass("opened")}).mouseleave(function(){tc.jQ(this).children(".dropdown").delay(200).fadeOut(f.fadeSpeed);tc.jQ(this).children("a").toggleClass("opened")})}d(function(h){var g=a._getTagsMarkup(h);tc.jQ(".browse-tags").html(g)})}e();return a};tc.modal=makeClass();tc.modal.prototype.modal=null;tc.modal.prototype.init=function(b,a){tc.util.log("tc.modal.init");this.options=tc.jQ.extend({element:null},a);this.options.element.overlay({top:"15%",left:"center",fixed:false,speed:75,mask:{color:"#55504b",opacity:0.5,zIndex:19998}});this.modal=this.options.element.data("overlay")};tc.modal.prototype.show=function(c,a){tc.util.log("tc.modal.show");var b="";function d(e){e.modal.load()}if(c.source_element){b=c.source_element.clone().removeClass("template-content")}this.options.element.children().remove();b.show();this.options.element.append(b);tc.util.dump(this.options.element.find(".close"));this.options.element.find(".close, .cancel").bind("click",{me:this},function(f){f.preventDefault();f.data.me.hide()});this.options.element.find(".submit").bind("click",{me:this,opts:c},function(f){f.preventDefault();f.data.me.hide();if(tc.jQ.isFunction(f.data.opts.submit)){f.data.opts.submit()}});this.options.element.bind("onBeforeClose",{me:this,opts:c},function(f){if(f.data.opts.preventClose){return false}return true});this.options.element.bind("onClose",{me:this},function(g){var f;f=g.data.me;if(tc.jQ.isFunction(f.cleanup)){f.cleanup.apply(f);f.cleanup=null}f.options.element.children().remove()});if(tc.jQ.isFunction(c.init)){if(a){c.init(this,a,d)}else{c.init(this,d)}}else{d(this)}};tc.modal.prototype.hide=function(){tc.util.log("tc.modal.hide");this.modal.close()};tc.carousel=makeClass();tc.carousel.prototype.carousel=null;tc.carousel.prototype.init=function(a){tc.util.log("tc.carousel.init");this.options=tc.jQ.extend({element:null,next_button:null,prev_button:null,scrollable:{items:".items",speed:300,circular:true},scrollPaneSelector:".scrollable:first",pagination:false},a);this.rendered=false;if(this.has_items()&&this.options.element.is(":visible")){this.render()}else{tc.util.log("postponing carousel rendering","warn")}};tc.carousel.prototype.destroy=function(){this.options.element.find(this.options.scrollPaneSelector).removeData("scrollable");if(this.next_btn){this.next_btn.unbind("click")}if(this.prev_btn){this.prev_btn.unbind("click")}};tc.carousel.prototype.render=function(e,a){var f,c,b,d;tc.util.log("tc.carousel.render");if(this.rendered===true){tc.util.log("carousel already rendered!!!","warn");return}f=this;b=e||this.options.element.width();d=a||0;this.options.element.width(b);c=this.options.element.find(this.options.scrollPaneSelector);c.children(this.options.scrollable.items).children("li").each(function(){var g,h;g=tc.jQ(this);g.width(b);h=g.outerHeight();if(h>d){d=h}});c.height(d);this.carousel=c.scrollable(this.options.scrollable).data("scrollable");this.carousel.onSeek(function(h,g){f.update_pagination()});this.carousel.onAddItem(function(h,g){f.update_navigation();f.update_pagination()});if(!this.next_btn){if(this.options.next_button){this.next_btn=this.options.next_button;this.next_btn.bind("click",{carousel:this.carousel},function(g){g.preventDefault();g.stopPropagation();g.data.carousel.next()})}else{this.next_btn=this.options.element.find(".next");this.next_btn.bind("click",function(g){g.preventDefault()})}}if(!this.prev_btn){if(this.options.prev_button){this.prev_btn=this.options.prev_button;this.prev_btn.bind("click",{carousel:this.carousel},function(g){g.preventDefault();g.stopPropagation();g.data.carousel.prev()})}else{this.prev_btn=this.options.element.find(".prev");this.prev_btn.bind("click",function(g){g.preventDefault()})}}this.rendered=true;this.update_navigation();this.update_pagination()};tc.carousel.prototype.update_navigation=function(){if(!this.rendered){return}tc.util.log("tc.carousel.update_navigation");if(this.carousel.getSize()<2){if(this.next_btn){this.next_btn.hide()}if(this.prev_btn){this.prev_btn.hide()}}else{if(this.next_btn){this.next_btn.show()}if(this.prev_btn){this.prev_btn.show()}}return this};tc.carousel.prototype.update_pagination=function(){if(!this.options.pagination||!this.rendered){return}tc.util.log("tc.carousel.update_pagination");if(this.options.pagination){this.options.pagination.current.text(this.carousel.getIndex()+1);this.options.pagination.total.text(this.carousel.getSize())}return this};tc.carousel.prototype.has_items=function(){return(this.options.element.find(this.options.scrollPaneSelector).children(this.options.scrollable.items).children("li").length>0)};tc.carousel.prototype.is_rendered=function(){return this.rendered};tc.carousel.prototype.get_element=function(){return this.options.element};if(!tc){var tc={}}tc.resource_tooltip=makeClass();tc.resource_tooltip.prototype.tooltip=null;tc.resource_tooltip.prototype.init=function(a){var b;tc.util.log("tc.resource_tooltip.init");b=this;this.options=tc.jQ.extend({triggers:tc.jQ(".tooltip_trigger"),trigger_class:null,tooltip_element:tc.jQ("#organization-tooltip"),markup_source_element:null,get_url:null},a);this.window=tc.jQ(window);this.tooltip=this.options.tooltip_element;this.triggers=this.options.triggers;this.triggers.bind("mouseover",{me:this},this.handlers.trigger_mouseover);this.triggers.bind("mouseout",{me:this},this.handlers.trigger_mouseout);this.tooltip.bind("mouseover",{me:this},this.handlers.tooltip_mouseover);this.tooltip.bind("mouseout",{me:this},this.handlers.tooltip_mouseout);this.has_been_shown=false;this.current_trigger=null;this.current_trigger_id=null;this.cached_data={}};tc.resource_tooltip.prototype.add_trigger=function(a){tc.util.log("tc.resource_tooltip.add_trigger");a.bind("mouseover",{me:this},this.handlers.trigger_mouseover);a.bind("mouseout",{me:this},this.handlers.trigger_mouseout);tc.util.dump(a);if(!this.triggers.length){this.triggers=a}else{this.triggers.add(a)}};tc.resource_tooltip.prototype.clear_triggers=function(a){tc.util.log("tc.resource_tooltip.clear_triggers");this.triggers.each(function(c,b){tc.jQ(b).unbind("mouseover").unbind("mouseout")})};tc.resource_tooltip.prototype.handlers={trigger_mouseover:function(b){var a;a=b.target;while(a.className.indexOf(b.data.me.options.trigger_class)==-1&&a.nodeName!="BODY"){a=a.parentNode}b.data.me.current_trigger=tc.jQ(a);b.data.me.tooltip.stop();b.data.me.show()},trigger_mouseout:function(c){var b,a;b=c.target;a=(c.relatedTarget)?c.relatedTarget:c.toElement;if(a){while(a!=b&&a.nodeName!="BODY"){a=a.parentNode;if(!a||a==b){return}}}c.data.me.tooltip.stop();c.data.me.hide()},tooltip_mouseover:function(a){if(a.data.me.current_trigger){a.data.me.tooltip.stop();a.data.me.show()}},tooltip_mouseout:function(c){var b,a;b=c.target;a=(c.relatedTarget)?c.relatedTarget:c.toElement;if(a){while(a!=b&&a.nodeName!="BODY"){a=a.parentNode;if(!a||a==b){return}}}c.data.me.tooltip.stop();c.data.me.hide()}};tc.resource_tooltip.prototype.generate_markup=function(b){tc.util.log("tc.resource_tooltip.generate_markup");var a;a=this.options.markup_source_element.clone().css("display","block").removeClass("template-content");a.prepend("<div class='tooltip-tail-top'></div>");a.append("<div class='tooltip-tail-bottom'></div>");a.find("h2").text(b.title);if(b.is_official&&b.is_official===1){a.find(".tooltip-hd").after('<div class="tooltip-md"><span>Official Resource</span></div>')}if(b.image_id>1){a.find("img").attr("src",media_root+"images/"+(b.image_id%10)+"/"+b.image_id+".png")}else{a.find("img").attr("src","/static/images/thumb_genAvatar100.png")}a.find(".main p").text(b.description);a.find("dd a").attr("target","_blank").attr("href",b.url).text(tc.truncate(b.url,28,"..."));return tc.jQ("<div>").append(a).html()};tc.resource_tooltip.prototype.show=function(){var b,c,a;b=function(d){if((d.current_trigger.offset().top-d.window.scrollTop())<d.tooltip.height()){return{flip:true,top:d.current_trigger.offset().top+d.current_trigger.height(),left:d.current_trigger.offset().left+(d.current_trigger.width()/2)-(d.tooltip.width()/2)}}else{return{flip:false,top:d.current_trigger.offset().top-d.tooltip.height(),left:d.current_trigger.offset().left+(d.current_trigger.width()/2)-(d.tooltip.width()/2)}}};c=this;a=false;if(this.current_trigger.attr("rel").split(",")[1]!=this.current_trigger_id){this.current_trigger_id=this.current_trigger.attr("rel").split(",")[1];a=true}if(this.cached_data[this.current_trigger_id]){if(a){this.tooltip.html((this.cached_data[this.current_trigger_id]))}this.move_to_target(b(this),this.has_been_shown?true:false)}else{if(a){this.tooltip.html('<div class="tooltip-bd spinner"><img class="loading" src="/static/images/loader32x32.gif" /></div>')}this.move_to_target(b(this),this.has_been_shown?true:false);if(a){tc.jQ.ajax({url:this.options.get_url,data:{project_resource_id:this.current_trigger_id},async:false,context:this,dataType:"json",success:function(e,d,f){this.cached_data[this.current_trigger_id]=this.generate_markup(e)}});this.tooltip.html(this.cached_data[this.current_trigger_id]);this.move_to_target(b(this),this.has_been_shown?true:false)}}};tc.resource_tooltip.prototype.move_to_target=function(b,a){if(b.flip){this.tooltip.addClass("flipped")}else{this.tooltip.removeClass("flipped")}if(a){this.tooltip.stop().show().animate({opacity:1,top:b.top,left:b.left},500,"easeOutCubic",function(){})}else{this.tooltip.stop().css({opacity:0,top:b.top,left:b.left}).show().animate({opacity:1},500,"easeOutCubic",function(){})}this.has_been_shown=true};tc.resource_tooltip.prototype.hide=function(){var a=this;this.tooltip.animate({opacity:0},200,"easeOutCirc",function(){tc.jQ(this).hide();a.current_trigger=null})};if(!tc){var tc={}}tc.locationDropdown=makeClass();tc.locationDropdown.validator=function(a,b){tc.util.log("tc.locationDropdown.validator");b.filter(".location-hood-enter").siblings(".error").hide();if(b.length==1){if(b.filter(".location-hood-enter").attr("location_id")){return{valid:true,errors:[]}}}else{if(b.filter(".location-city").filter(":checked").length||b.filter(".location-city")[0].checked){return{valid:true,errors:[]}}if(b.filter(".location-hood").filter(":checked").length||b.filter(".location-hood")[0].checked){if(b.filter(".location-hood-enter").attr("location_id")){return{valid:true,errors:[]}}}}b.filter(".location-hood-enter").addClass("not-valid").removeClass("valid");b.filter(".location-hood-enter").siblings(".error").show();return{valid:false,errors:["Please enter a neighborhood."]}};tc.locationDropdown.prototype.init=function(a){var b,c;this.options=tc.jQ.extend({radios:null,input:null,list:null,warning:null,step:null,locations:tc.locations,scrollMenuThreshold:10},a);this.bindEvents();if(this.options.warning){this.options.warning.hide()}this.options.list.hide().children("ul").children().remove();if(this.options.input.attr("location_id")){for(b=0;b<this.options.locations.length;b++){if(this.options.locations[b].location_id==this.options.input.attr("location_id")){this.options.input.val(decodeURI(this.options.locations[b].name));c=true;break}}if(!c){this.options.input.removeAttr("location_id")}}};tc.locationDropdown.prototype.getLocation=function(){if(this.options.input.attr("location_id")){return this.options.input.attr("location_id")}return false};tc.locationDropdown.prototype.bindEvents=function(){this.options.input.bind("focus blur keydown keyup keypress",{dropdown:this},function(a){switch(a.type){case"focus":a.data.dropdown.inputFocusHandler(a);break;case"keyup":a.data.dropdown.inputKeyUpHandler(a);break;case"keydown":a.data.dropdown.inputKeyDownHandler(a);break;case"keypress":a.data.dropdown.inputKeyPressHandler(a);break;case"blur":a.data.dropdown.inputBlurHandler(a);break}});this.options.list.bind("focus click blur",{dropdown:this},function(a){switch(a.type){case"focus":a.data.dropdown.listFocusHandler(a);break;case"click":a.data.dropdown.listClickHandler(a);break;case"blur":a.data.dropdown.listBlurHandler(a);break}});if(this.options.radios){this.options.radios.bind("change",{dropdown:this},function(a){a.data.dropdown.radioHandler(a)})}};tc.locationDropdown.prototype.open=function(){tc.jQ("body").bind("click.location_dropdown",{dropdown:this},this.anywhereClickHandler);this.handleListScrollbar();if(this.options.list.find("li").length){this.options.list.show()}};tc.locationDropdown.prototype.close=function(){tc.jQ("body").unbind("click.location_dropdown",this.anywhereClickHandler);this.options.list.hide()};tc.locationDropdown.prototype.anywhereClickHandler=function(a){var b;b=a.data.dropdown;if(!tc.jQ.contains(b.options.list[0],a.target)&&a.target!==b.options.input[0]){b.close()}};tc.locationDropdown.prototype.listFocusHandler=function(a){tc.util.log("tc.locationDropdown.listFocusHandler")};tc.locationDropdown.prototype.listClickHandler=function(b){var a,c;if(b.target.nodeName=="SPAN"){a=b.target.parentNode}else{if(b.target.nodeName=="A"){a=b.target}}if(!a){return}b.preventDefault();if(b.data.dropdown.options.warning){b.data.dropdown.options.warning.hide()}c=a.hash.substring(1,a.hash.length).split(",");b.data.dropdown.options.input.removeClass("not-valid").addClass("valid").attr("location_id",c[1]).val(decodeURI(c[0])).trigger("change");b.data.dropdown.close()};tc.locationDropdown.prototype.listBlurHandler=function(a){tc.util.log("tc.locationDropdown.listBlurHandler")};tc.locationDropdown.prototype.inputFocusHandler=function(a){var b;b=a.data.dropdown;tc.util.log("tc.locationDropdown.inputFocusHandler");if(b.options.radios&&b.options.radios.filter(".location-hood").length){b.options.radios.filter(".location-hood").attr("checked",true);tc.jQ('label[for="location-hood"]').trigger("fake-click",{preventChange:true})}b.open();if(a.target.value.toLowerCase()=="all neighborhoods"){a.target.value=""}};tc.locationDropdown.prototype.inputBlurHandler=function(a){tc.util.log("tc.locationDropdown.inputBlurHandler")};tc.locationDropdown.prototype.inputKeyUpHandler=function(a){if(a.which==38||a.which==40||a.which==13){a.preventDefault();a.stopPropagation();return}this.options.input.removeClass("valid").addClass("not-valid").removeAttr("location_id");this.superFilterAndUpdateList(a.target.value)};tc.locationDropdown.prototype.inputKeyDownHandler=function(a){switch(a.which){case 13:a.preventDefault();a.stopPropagation();this.modifySelection(0);break;case 38:a.preventDefault();this.modifySelection(-1);break;case 40:a.preventDefault();this.modifySelection(1);break}};tc.locationDropdown.prototype.inputKeyPressHandler=function(a){if(a.which==13){a.preventDefault()}};tc.locationDropdown.prototype.modifySelection=function(b){var a;a=this.options.list.find(".selected");if(!a.length){this.options.list.find("li:first").addClass("selected");return}switch(b){case -1:a.removeClass("selected").prev().addClass("selected");break;case 0:a.children("a").click();break;case 1:a.removeClass("selected").next().addClass("selected");break}};tc.locationDropdown.prototype.radioHandler=function(b){var a;if(!b.target.checked){return}switch(b.target.id){case"location-city":this.options.input.data("last-value",this.options.input.val()).val("").removeClass("not-valid").removeClass("valid").attr("location_id","-1");this.close();break;case"location-hood":a=this.options.input.data("last-value");if(this.options.input.attr("location_id")){this.options.input.removeClass("not-valid").addClass("valid")}else{this.open()}if(a){this.options.input.val(decodeURI(a));this.superFilterAndUpdateList(a,true)}break}};tc.locationDropdown.prototype.superFilterAndUpdateList=function(g){var b,c,d,f,e,a;c=new RegExp(g,"gi");d=0;a="";for(b=0;b<this.options.locations.length;b++){f=this.options.locations[b].name.search(c);if(f==-1){continue}if(f==0){e='<li><a href="#'+this.options.locations[b].name+","+this.options.locations[b].location_id+'"><span>'+this.options.locations[b].name.substring(0,g.length)+"</span>"+this.options.locations[b].name.substring(g.length,this.options.locations[b].name.length)+"</a></li>"}else{e='<li><a href="#'+this.options.locations[b].name+","+this.options.locations[b].location_id+'">'+(""+this.options.locations[b].name.substring(0,f))+"<span>"+this.options.locations[b].name.substring(f,f+g.length)+"</span>"+this.options.locations[b].name.substring(f+g.length,this.options.locations[b].name.length)+"</a></li>"}a+=e;a=a;d++}if(!d){if(this.options.warning){this.options.warning.show()}this.options.input.removeClass("valid").addClass("not-valid").removeAttr("location_id")}else{this.options.list.children("ul").html(a);if(d==1){this.options.list.find("li:first").addClass("selected")}if(!this.options.input.attr("location_id")){this.open()}else{this.handleListScrollbar()}}};tc.locationDropdown.prototype.handleListScrollbar=function(){var a;if(!this.options.scrollMenuThreshold){return}a=this.options.list.children("ul").children("li").length;this.options.list[a>this.options.scrollMenuThreshold?"addClass":"removeClass"]("has-scrollbar")};if(!tc){var tc={}}tc.inlineEditor=function(a){this.init(a)};tc.inlineEditor.prototype={init:function(a){this.options=tc.jQ.extend({dom:null,service:null,empty_text:"Click here to edit.",validators:null,charlimit:null},a);if(typeof this.options.dom==="string"){this.options.dom=tc.jQ(this.options.dom)}this.dom=this.options.dom;this.controls=this.dom.find(".inline-edit-controls");this.controls.hide().empty().append(this._generateControls());this.controls.find(".save-btn").bind("click",{me:this},function(b){b.preventDefault();b.data.me.save()});this.controls.find(".cancel-btn").bind("click",{me:this},function(b){b.preventDefault();b.data.me.display()});this.content=this.dom.find(".editable-content");this.content.bind("click",{me:this},function(b){if(b.data.me.state==="display"){b.data.me.edit()}});if(this.options.charlimit){if(!(tc.jQ.isArray(this.options.validators))){this.options.validators=[]}this.options.validators.push("max-"+this.options.charlimit)}this.data=tc.jQ.trim(this.content.text());this.display()},edit:function(){var b,a;tc.util.log("edit");if(this.state==="edit"){return}this.content.html("<textarea class='data serif'>"+(this.data||"")+"</textarea>");b=this.content.find(".data");b.bind("keypress",{me:this,field:b},function(c){c.data.me.validate(c.data.field)});if(this.options.charlimit){a=tc.jQ("<span class='charlimit'></span>");a.text((this.data?this.data.length:"0")+"/"+this.options.charlimit);this.content.append(a);b.bind("keyup",{me:this,field:b,dom:a,limit:this.options.charlimit},function(c){c.data.dom.text(c.data.field.val().length+"/"+c.data.limit)})}this.controls.show();this.dom.addClass("state-editing").removeClass("state-display");this.state="edit"},display:function(){if(this.state==="display"){return}this.content.empty();if(this.data){this.dom.removeClass("state-empty");this._renderDisplayContent()}else{this.dom.addClass("state-empty");this.content.text(this.options.empty_text)}this.controls.hide();this.dom.removeClass("state-editing").addClass("state-display");this.state="display"},validate:function(a){if(!tc.jQ.isArray(this.options.validators)){return true}return tc.validate(a,this.options.validators).valid},save:function(d){var c,a,b;if(this.state==="edit"){a=this.content.find(".data");if(tc.jQ.isFunction(this._getPostData)){b=this._getPostData()}else{b=tc.jQ.trim(a.val())}if(a.hasClass("not-valid")){return false}if(!this.validate(a)){return false}if(this.options.service.post_data){c=tc.jQ.extend({},this.options.service.post_data)}else{c={}}c[this.options.service.param]=b;tc.jQ.ajax({type:"POST",dataType:"text",url:this.options.service.url,data:c,context:this,success:function(f,e,g){if(tc.jQ.isFunction(d)){d.apply(this,[f,e,g]);return}if(f==="False"){this.display();return}this.data=c[this.options.service.param];this.display()}})}},_generateControls:function(){return'<a href="#" class="ca-btn save-btn">Save</a><a href="#" class="cancel-btn">Cancel</a>'},_renderDisplayContent:function(){this.content.text(this.data)}};tc.inlineLocationEditor=function(a){this.init(a);this.locationDropdown=null};tc.inlineLocationEditor.prototype=tc.jQ.extend({},tc.inlineEditor.prototype,{edit:function(){if(this.state==="edit"){return}this.content.html("<input type='text' class='location-group location-hood-enter always-focused' value='"+tc.jQ.trim(this.content.text())+"'/>				<div class='location-hood-list' style='display: none'><ul><li></li></ul></div>");this.locationDropdown=new tc.locationDropdown({input:this.content.find("input.location-hood-enter"),list:this.content.find("div.location-hood-list"),locations:this.options.locations});this.controls.show();this.dom.addClass("state-editing").removeClass("state-display");this.state="edit"},save:function(){tc.inlineEditor.prototype.save.call(this,function(b,a,c){if(b==="False"){this.display();return}if(this._getPostData()==="-1"){this.data="Citywide"}else{this.data=this.content.find("input.location-hood-enter").val()}this.display()})},_getPostData:function(){if(this.locationDropdown){return this.locationDropdown.getLocation()||"-1"}return"-1"}});tc=tc||{};tc.gam=tc.gam||{};tc.gam.project=function(c,b){var a={app:c,project_data:c.app_page.data.project,user:c.app_page.user,project_user:c.app_page.project_user,media_root:c.app_page.media_root};c.components.project_widgets={home:tc.gam.project_widgets.home(tc.jQ.extend({name:"home",dom:b.find(".project-section.home")},a)),needs:tc.gam.project_widgets.needs(tc.jQ.extend({name:"needs",dom:b.find(".project-section.needs")},a)),"need-detail":tc.gam.project_widgets.needs(tc.jQ.extend({name:"need-detail",dom:b.find(".project-section.need-detail")},a)),"need-form":tc.gam.project_widgets.need_form(tc.jQ.extend({name:"need-form",dom:b.find(".project-section.need-form")},a)),events:tc.gam.project_widgets.events(tc.jQ.extend({name:"events",dom:b.find(".project-section.events")},a)),"event-detail":tc.gam.project_widgets.events(tc.jQ.extend({name:"event-detail",dom:b.find(".project-section.event-detail")},a)),"event-needs":tc.gam.project_widgets.events(tc.jQ.extend({name:"event-needs",dom:b.find(".project-section.event-needs")},a)),"event-form":tc.gam.project_widgets.event_form(tc.jQ.extend({name:"event-form",dom:b.find(".project-section.event-form")},a)),infopane:tc.gam.project_widgets.infopane(tc.jQ.extend({name:"infopane",dom:b.find(".box.mission")},a)),resources:tc.gam.project_widgets.resources(tc.jQ.extend({name:"resources",dom:b.find(".box.resources")},a)),related_resources:tc.gam.project_widgets.related_resources(tc.jQ.extend({name:"related_resources",dom:b.find(".project-section.related-resources")},a)),add_link:tc.gam.project_widgets.add_link(tc.jQ.extend({name:"add_link",dom:b.find(".project-section.add-link")},a)),conversation:tc.gam.project_widgets.conversation(tc.jQ.extend({name:"conversation",dom:b.find(".project-section.conversation")},a)),members:tc.gam.project_widgets.members(tc.jQ.extend({name:"members",dom:b.find(".project-section.members")},a))};if(tc.gam.project_widgets.fresh_ideas){c.components.related_ideas=tc.gam.project_widgets.fresh_ideas(tc.jQ.extend({name:"fresh_ideas",dom:b.find(".box.fresh-ideas")},a))}tc.gam.project_widgets.project_tabs(tc.jQ.extend({name:"project_tabs",dom:b.find(".project-tabs")},a));tc.gam.widgetVisibilityHandler()};if(!tc){var tc={}}if(!tc.gam){tc.gam={}}tc.gam.ideas_invite=function(c,a){var b=tc.jQ.extend({elements:null,ref_project_id:null},a);b.elements.bind("click",{app:c,source_element:tc.jQ(".modal-content.invite-user"),init:function(f,d,g){var e;e=new tc.merlin(c,{use_hashchange:false,name:"ideas_invite",dom:f.options.element.find(".invite-user"),next_button:tc.jQ("a.submit"),first_step:b.ref_project_id?"invite-message-info":"invite-message-project-info",data:{project_id:b.ref_project_id?b.ref_project_id:null,idea_id:null,message:null},steps:{"invite-message-project-info":{selector:".invite-message-project-info",next_step:"invite-message-info",inputs:{project_radios:{selector:".project-radio"}},init:function(h,k){var j;if(k.find(".project-radio").length==1){k.find(".project-radio").first().attr("checked",true);h.show_step("invite-message-info");return}j=tc.jQ(d).attr("href").split(",")[2];if(j){k.find(".no-name").hide();k.find(".name").text(j)}else{k.find(".has-name").hide()}k.find("input[type=checkbox],input[type=radio]").prettyCheckboxes()},finish:function(h,j){if(!h.current_step.inputs.project_radios.dom.filter(":checked").length){h.options.data.project_id=null;return false}h.options.data=tc.jQ.extend(h.options.data,{project_id:h.current_step.inputs.project_radios.dom.filter(":checked").attr("rel").split(",")[1]});return true}},"invite-message-info":{selector:".invite-message-info",next_step:"invite-message-submit",inputs:{invite_message:{selector:"textarea.invite-message",validators:["max-200"],counter:{selector:".charlimit.invite-message",limit:200}}},init:function(h,k){var j;if(!h.options.data.project_id){h.show_step("invite-message-project-info");return}j=tc.jQ(d).attr("href").split(",")[2];if(j){k.find(".no-name").hide();k.find(".name").text(j)}else{k.find(".has-name").hide()}},finish:function(h,j){h.options.data=tc.jQ.extend(h.options.data,{idea_id:tc.jQ(d).attr("href").split(",")[1],message:h.current_step.inputs.invite_message.dom.val()})}},"invite-message-submit":{selector:".invite-message-submit",init:function(h,j){tc.jQ.ajax({type:"POST",url:"/project/invite",data:h.options.data,context:h,dataType:"text",success:function(l,k,m){if(l=="False"){h.show_step("invite-message-error");return false}tc.jQ(d).addClass("disabled").text("Invited").unbind("click").bind("click",function(n){n.preventDefault()});tc.timer(1000,function(){f.hide()})}})}},"invite-message-error":{selector:".invite-message-error",init:function(h,j){tc.timer(1000,function(){f.hide()})}}}});f.cleanup=function(){e.deallocate_magic()};if(tc.jQ.isFunction(g)){g(f)}}},function(f,g){f.preventDefault();f.data.app.components.modal.show(f.data,f.target)})};if(!tc){var tc={}}if(!tc.gam){tc.gam={}}tc.gam.add_resource=function(c,a){var b=tc.jQ.extend({elements:null},a);b.elements.bind("click",{app:c,source_element:tc.jQ(".modal-content.add-resource"),init:function(f,d,g){var e;e=new tc.merlin(c,{use_hashchange:false,name:"add-resource",dom:f.options.element.find(".add-resource"),next_button:tc.jQ("a.submit"),first_step:"add-resource-project-info",data:{project_id:null,project_resource_id:null},steps:{"add-resource-project-info":{selector:".add-resource-project-info",next_step:"add-resource-submit",inputs:{project_radios:{selector:".project-radio",vallidators:["required"]}},init:function(h,k){var j;k.find("input[type=checkbox],input[type=radio]").prettyCheckboxes();if(k.find(".project-radio").length==1){k.find(".project-radio").first().attr("checked",true)}},finish:function(h,j){if(h.current_step.inputs.project_radios.dom.filter(":checked").length){h.options.data=tc.jQ.extend(h.options.data,{project_id:h.current_step.inputs.project_radios.dom.filter(":checked").attr("rel").split(",")[1],project_resource_id:d.hash.split(",")[1]})}}},"add-resource-submit":{selector:".add-resource-submit",init:function(h,j){tc.jQ.ajax({type:"POST",url:"/project/resource/add",data:h.options.data,context:h,dataType:"text",success:function(l,k,m){tc.jQ(d).parents("td").addClass("added");tc.timer(1000,function(){f.hide()})}})}}}});if(tc.jQ.isFunction(g)){g(f)}}},function(f,g){f.preventDefault();f.data.app.components.modal.show(f.data,f.target)})};tc.user_handler=function(a){return function(b){if(b.app_page.user){if(typeof a.user_handler=="function"){if(a.user_handler(b)===false){return false}}}else{if(typeof a.no_user_handler=="function"){if(a.no_user_handler(b)===false){return false}}}return true}};tc.app=makeClass();tc.app.prototype.app_page=null;tc.app.prototype.components={};tc.app.prototype.events=tc.jQ({});tc.app.prototype.init=function(c){var a=this;var b;this.app_page=c;tc.jQ.ajaxSetup({cache:false});if(c.features){for(i in c.features){if(tc.jQ.isFunction(c.features[i])){if(c.features[i](a)===false){break}}}}this.finish_logout=function(d){window.location.hash="";if(window.location.pathname==="/useraccount"){if(d.data.app.app_page.user){window.location.assign("/useraccount/"+d.data.app.app_page.user.u_id);return}}window.location.reload(true)};tc.jQ(window).bind("hashchange",{app:this},function(d){if(window.location.hash.substring(1,window.location.hash.length)==="logout"){tc.jQ.ajax({type:"POST",url:"/logout",context:d.data.app,dataType:"text",success:function(g,f,h){var e=this;if(FB._userStatus=="unknown"){e.finish_logout(d)}else{FB.getLoginStatus(function(j){if(j.session){FB.logout(function(k){e.finish_logout(d)})}else{e.finish_logout(d)}})}}})}})};